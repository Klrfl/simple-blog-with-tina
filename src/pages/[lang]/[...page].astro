---
import type { GetStaticPaths } from "astro";
import config from "@config/config.json";
import Layout from "@layouts/index.astro";
import List from "@components/List.astro";
import { langs } from "src/i18n";
import { getContent } from "@lib/contentParser.astro";
import { sortByDate } from "@lib/utils/sortFunctions";

export const getStaticPaths = (async ({ paginate }) => {
	const allPosts = await getContent("posts");

  return langs.flatMap(lang => {
    const normalizedPosts = sortByDate(allPosts)
    .filter(post => {
      const [postLang] = post.slug.split("/")
      return postLang === lang
    })
    .map(post => {
      const [, slug] = post.slug.split("/")
      return { ...post, slug }
    });

    return paginate(normalizedPosts, {
      params: { lang },
  		pageSize: config.settings.pagination,
  	});
  })
}) satisfies GetStaticPaths;

const title = config.site.title;
const { page } = Astro.props;
---

<Layout title={title}>
	<List title={title} page={page} url="posts/" />
</Layout>
